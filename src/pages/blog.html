<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Blog | Turismo Cómbita</title>
    <meta name="description" content="Blog de turismo de Cómbita, Boyacá - Artículos sobre naturaleza, cultura, senderismo y más">
    <script src="../assets/js/vendor/jquery.min.js"></script>
    <script src="../assets/js/vendor/main.js"></script>
    <link rel="stylesheet" href="../assets/css/vendor/bootstrap-grid.css">
    <link rel="stylesheet" href="../assets/css/vendor/style.css">
    <link rel="stylesheet" href="../assets/css/vendor/glide.css">
    <link rel="stylesheet" href="../assets/css/vendor/content-box.css">
    <link rel="stylesheet" href="../assets/css/vendor/social.css">
    <link rel="stylesheet" href="../assets/media/icons/fontawesome/all.css">
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/frailejon-theme.css">
    <link rel="icon" href="../assets/images/favicon.png">
</head>
<body class="page-main">
    <div id="preloader"></div>
    <nav class="menu-classic menu-fixed align-right" data-menu-anima="fade-in">
        <div class="container">
            <div class="menu-brand">
                <a href="./index.html">
                    <img class="logo-default scroll-hide" src="../assets/images/icons/LOGO COLOR VECTORIZADO.png" alt="logo" />
                    <img class="logo-retina scroll-hide" src="../assets/images/icons/LOGO COLOR VECTORIZADO.png" alt="logo" />
                    <img class="logo-default scroll-show" src="../assets/images/icons/lgoo-dos.png" alt="logo" />
                    <img class="logo-retina scroll-show" src="../assets/images/icons/lgoo-dos.png" alt="logo" />
                </a>
            </div>
            <i class="menu-btn"></i>
            <div class="menu-cnt">
                <ul id="main-menu">
                    <li class="dropdown">
                        <a href="./index.html">Inicio</a>
                    </li>
                    <li class="dropdown">
                        <a href="#">Descubre</a>
                        <ul>
                            <li>
                                <a href="./about.html">Acerca de</a>
                            </li>
                            <li class="dropdown-submenu">
                                <a>Imperdibles</a>
                                <ul>
                                    <li><a href="./food.html">Restaurantes</a></li>
                                    <li><a href="./shelters.html">Hospedajes</a></li>
                                    <li><a href="./events.html">Eventos</a></li>
                                    <li><a href="./artesanos-guias.html">Artesanos y Guías</a></li>
                                </ul>
                            </li>
                            <li class="dropdown-submenu">
                                <a>Explora Más</a>
                                <ul>
                                    <li><a href="./history.html">Historia</a></li>
                                    <li><a href="./gallery.html">Galería</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="./treks/index.html">Caminatas</a>
                    </li>
                    <li class="dropdown">
                        <a href="#">Planifica</a>
                        <ul>
                            <li><a href="./transporte.html">Cómo Llegar</a></li>
                            <li><a href="./mapa.html">Mapa</a></li>
                            <li><a href="./tips.html">Tips del Viajero</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="./blog.html">Blog</a>
                    </li>
                    <li>
                        <a href="./contacts.html">Contacto</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <header class="header-image ken-burn-center light" data-parallax="true" data-natural-height="1080" data-natural-width="1920" data-bleed="0" data-image-src="../assets/images/laguna rica.jpg" data-offset="0">
        <div class="container">
            <h1>Blog</h1>
            <h2>Historias, guías y novedades de Cómbita</h2>
            <ol class="breadcrumb">
                <li><a href="./index.html">Inicio</a></li>
                <li><a href="#">Blog</a></li>
            </ol>
        </div>
    </header>
    <main>
        <section class="section-base section-color">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8">
                        <div id="blogPostsContainer">
                            <div style="text-align:center;padding:40px;">
                                <i class="fas fa-spinner fa-spin" style="font-size:30px;color:#699073;"></i>
                                <p style="margin-top:10px;color:#999;">Cargando publicaciones...</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <h3>Categorías</h3>
                        <hr class="space-xs" />
                        <div class="menu-inner menu-inner-vertical">
                            <ul id="blogCategorias">
                                <li><a href="#" onclick="filterBlog(''); return false;">Todas</a></li>
                                <li><a href="#" onclick="filterBlog('naturaleza'); return false;">Naturaleza</a></li>
                                <li><a href="#" onclick="filterBlog('cultura'); return false;">Cultura</a></li>
                                <li><a href="#" onclick="filterBlog('senderismo'); return false;">Senderismo</a></li>
                                <li><a href="#" onclick="filterBlog('gastronomia'); return false;">Gastronomía</a></li>
                                <li><a href="#" onclick="filterBlog('historia'); return false;">Historia</a></li>
                                <li><a href="#" onclick="filterBlog('eventos'); return false;">Eventos</a></li>
                            </ul>
                        </div>
                        <hr class="space-sm" />
                        <h3>Publicaciones Recientes</h3>
                        <hr class="space-sm" />
                        <div class="menu-inner menu-inner-vertical menu-inner-image">
                            <ul id="blogRecientes">
                                <!-- Loaded via JS -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer class="light">
        <div class="container">
            <div class="row">
                <div class="col-lg-4">
                    <h3>Cómbita</h3>
                    <p>En algún lugar entre el inicio de la ascensión y la cima, se encuentra la respuesta al misterio
                        de por qué subimos.</p>
                </div>
                <div class="col-lg-4">
                    <h3>Contacto</h3>
                    <ul class="icon-list icon-line">
                        <li>Cómbita, Boyacá, Colombia</li>
                        <li>alcaldia@combita-boyaca.gov.co</li>
                        <li> 313 366232</li>
                    </ul>
                </div>
                <div class="col-lg-4">
                    <div class="icon-links icon-social icon-links-grid social-colors">
                        <a class="facebook"><i class="icon-facebook"></i></a>
                        <a class="instagram"><i class="icon-instagram"></i></a>
                        <a class="x"><i class="icon-twitter"></i></a>
                        <a class="youtube"><i class="icon-youtube"></i></a>
                    </div>
                    <hr class="space-sm" />
                    <p>Siguenos en nuestras redes</p>
                </div>
            </div>
        </div>
        <div class="footer-bar">
            <div class="container">
                <span>&copy; 2024 Santiago Quiroga Molina <a href="https://santiago-developer.netlify.app/" target="_blank">santiago-developer.com</a>.</span>
                <span><a href="./contacts.html">Contacto</a> | <a href="./privacidad.html">Política de privacidad</a></span>
            </div>
        </div>
    </footer>
    <script src="../assets/js/vendor/parallax.min.js"></script>
    <script src="../assets/js/vendor/glide.min.js"></script>
    <script src="../assets/js/vendor/imagesloaded.min.js"></script>

    <script>
        const API_BASE = window.location.origin + '/api';

        let allPosts = [];

        document.addEventListener('DOMContentLoaded', () => {
            loadBlogPosts();
        });

        async function loadBlogPosts() {
            try {
                const res = await fetch(`${API_BASE}/blog?activo=true`);
                allPosts = await res.json();
                renderPosts(allPosts);
                renderRecientes(allPosts);
            } catch (error) {
                console.error('Error cargando blog:', error);
                document.getElementById('blogPostsContainer').innerHTML =
                    '<p style="text-align:center;color:#999;padding:40px;">No se pudieron cargar las publicaciones.</p>';
            }
        }

        function renderPosts(posts) {
            const container = document.getElementById('blogPostsContainer');

            if (posts.length === 0) {
                container.innerHTML = '<p style="text-align:center;color:#999;padding:40px;">No hay publicaciones disponibles.</p>';
                return;
            }

            const meses = ['ENE', 'FEB', 'MAR', 'ABR', 'MAY', 'JUN', 'JUL', 'AGO', 'SEP', 'OCT', 'NOV', 'DIC'];
            const categoriasNombres = {
                naturaleza: 'Naturaleza', cultura: 'Cultura', gastronomia: 'Gastronomía',
                senderismo: 'Senderismo', historia: 'Historia', eventos: 'Eventos', general: 'General'
            };

            let html = '<div class="grid-list" data-columns="1"><div class="grid-box">';

            posts.forEach(post => {
                const fecha = new Date(post.creado);
                const dia = fecha.getDate().toString().padStart(2, '0');
                const mes = meses[fecha.getMonth()];
                const año = fecha.getFullYear();
                const fechaTexto = `${dia} / ${(fecha.getMonth() + 1).toString().padStart(2, '0')} / ${año}`;

                html += `
                    <div class="grid-item grid-item-blog">
                        <div class="cnt-box cnt-box-blog-side boxed" data-href="./post.html?id=${post.id}">
                            <a href="./post.html?id=${post.id}" class="img-box">
                                <div class="blog-date">
                                    <span>${dia}</span>
                                    <span>${mes} ${año}</span>
                                </div>
                                ${post.imagen
                                    ? `<img src="${post.imagen}" alt="${post.titulo}" />`
                                    : '<img src="../assets/images/laguna rica.jpg" alt="Blog" />'
                                }
                            </a>
                            <div class="caption">
                                <h2>${post.titulo}</h2>
                                <ul class="icon-list icon-list-horizontal">
                                    <li><i class="icon-calendar"></i><a href="#">${fechaTexto}</a></li>
                                    <li><i class="icon-bookmark"></i><a href="#" onclick="filterBlog('${post.categoria}'); return false;">${categoriasNombres[post.categoria] || post.categoria}</a></li>
                                    <li><i class="icon-user"></i><a href="#">${post.autor || 'Admin'}</a></li>
                                </ul>
                                <p>${post.extracto || ''}</p>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += '</div></div>';
            container.innerHTML = html;
        }

        function renderRecientes(posts) {
            const ul = document.getElementById('blogRecientes');
            const recientes = posts.slice(0, 4);

            ul.innerHTML = recientes.map(post => {
                const fecha = new Date(post.creado);
                const opciones = { year: 'numeric', month: 'long', day: 'numeric' };
                const fechaTexto = fecha.toLocaleDateString('es-CO', opciones);

                return `
                    <li>
                        <a href="./post.html?id=${post.id}">
                            ${post.imagen ? `<img src="${post.imagen}" alt="${post.titulo}" />` : `<img src="../assets/images/laguna rica.jpg" alt="" />`}
                            <span>${fechaTexto}</span>
                            ${post.titulo}
                        </a>
                    </li>
                `;
            }).join('');
        }

        function filterBlog(categoria) {
            if (!categoria) {
                renderPosts(allPosts);
            } else {
                const filtered = allPosts.filter(p => p.categoria === categoria);
                renderPosts(filtered);
            }
            window.scrollTo({ top: 300, behavior: 'smooth' });
        }
    </script>
</body>
</html>
